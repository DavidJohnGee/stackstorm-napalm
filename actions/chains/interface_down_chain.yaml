---
  chain:
      -
        name: "show_interface"
        ref: "napalm.get_interfaces"
        parameters:
          hostname: "{{ hostname }}"
          host_ip: "{{ host_ip }}"
          interface: "{{ interface }}"
        on-success: "show_log"
        on-failure: "report_failure"
      -
        name: "show_log"
        ref: "napalm.get_log"
        parameters:
          hostname: "{{ hostname }}"
          host_ip: "{{ host_ip }}"
          lastlines: 10
        on-success: "send_email"
        on-failure: "report_failure"
      -
        name: "send_email"
        ref: "core.sendmail"
        parameters:
          to: "{{st2kv.system.napalm_interface_down_mailto}}"
          from: "{{st2kv.system.napalm_interface_down_mailfrom}}"
          subject: "Interface {{ interface }} is down on {{ hostname }}."
          content_type: "text/plain"
          body: "\r\n{{ message }}\r\n\r\n
                \r\n{{ show_interface.result | to_json_string }}\r\n\r\n
                \r\nLog file from Device:\r\n\r\n
                {% for log_line in show_log.result %}
                  \r\n{{ log_line }}
                {% endfor %}
                \r\n\r\n"
      -
        name: "report_failure"
        ref: "core.sendmail"
        parameters:
          to: "{{st2kv.system.napalm_actionerror_mailto}}"
          from: "{{st2kv.system.napalm_actionerror_mailfrom}}"
          subject: "Stackstorm interface down workflow error"
          body:  "Something went wrong with the interface down workflow. Check stackstorm for the error. Execution ID: {{action_context.parent.execution_id}}.\r\n\r\n"
  default: "show_interface"
